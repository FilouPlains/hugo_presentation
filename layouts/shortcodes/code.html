{{- /* Renders a syntax-highlighted code block.

Parameters
----------
language : `str`, optional
    The programming language for syntax highlighting ("python", "javascript"…).
    Maps to the `class="language-..."` attribute. By default, nil.

trim : `bool`, optional
    If true, tells Reveal.js to trim surrounding whitespace from the displayed
    code. Maps to the `data-trim` attribute. By default, `false`.

no_escape : `bool`, optional
    If true, prevents Reveal.js from escaping HTML characters inside the code
    block. Maps to the `data-noescape` attribute. By default, `false`.

line_number : `bool | str`, optional
    Controls the display of line numbers:
    - If `false`: No line numbers.
    - If `true`: Default line numbers enabled.
    - If `string`: Enables specific line highlighting (for example "1-3|5|8").

    Maps to the `data-line-numbers` attribute. By default, `false`.

start_from : `integer`, optional
    The line number to start counting from. Maps to the `data-ln-start-from`
    attribute. By default, nil.

Examples
--------
```md
    {{< code language="python" line_number="1|2-4" >}}
    import numpy

    def hello():
        print("Reveal.js + Hugo")
    {{< /code >}}
```
*/ -}}

{{- $language := .Get "language" -}}
{{- $trim := .Get "trim" | default false -}}
{{- $no_escape := .Get "no_escape" | default false -}}
{{- $line_number := .Get "line_number" | default false -}}
{{- $start_from := .Get "start_from" -}}

{{- /*
    3 case:
        - Line number is not given.
        - Line number is given as a simple tag.
        - Line number is given with values.
*/ -}}
{{- if $line_number -}}
    {{- if eq (printf "%T" $line_number) "string" -}}
        {{- $line_number = (printf "data-line-numbers='%s'" $line_number) -}}
    {{- else -}}
        {{- $line_number = "data-line-numbers" -}}
    {{- end -}}
{{- end -}}

{{- /*
    Here, we concatenate every attributes to have a “one-liner”.
*/ -}}

{{- $attribute := slice -}}

{{- if $language }}
    {{- $attribute = $attribute | append (printf "class='language-%s'" $language) -}}
{{ end -}}
{{- if $trim }}
    {{- $attribute = $attribute | append "data-trim" -}}
{{ end -}}
{{- if $no_escape }}
    {{- $attribute = $attribute | append "data-noescape" -}}
{{ end -}}
{{- if $line_number -}}
    {{- $attribute = $attribute | append $line_number -}}
{{ end -}}
{{- if $start_from }}
    {{- $attribute = $attribute | append (printf "data-ln-start-from='%d'" $start_from) -}}
{{ end -}}

{{- "\n" -}}
<pre>
    <code {{ delimit $attribute " " | safeHTMLAttr }}>
        {{- .Inner | strings.TrimSpace | safeHTML -}}
    </code>
</pre>
